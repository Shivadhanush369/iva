<div class="right">

<div class="top">
   <button id="menu_bar">
     <span class="material-symbols-sharp">menu</span>
   </button>

   <div class="theme-toggler">
     <span class="material-symbols-sharp active">light_mode</span>
     <span class="material-symbols-sharp">dark_mode</span>
   </div>
    <div class="profile">
       <div class="info">
           <p><b>Babar</b></p>
           <p>-</p>
           <small class="text-muted"></small>
       </div>
       <div class="profile-photo">
         <img src="https://media.istockphoto.com/id/517998264/vector/male-user-icon.webp?s=1024x1024&w=is&k=20&c=i2eQlg8dK8RgTguGTyLmuCQ9IPBIlW-MXwDBMIPggVs=" alt=""/>
       </div>
    </div>
</div>

  <div class="recent_updates">
     <h2>Recent Update</h2>
   <div class="updates">
      <div class="update">
         <div class="profile-photo">
            <img src="./images/profile-4.jpg" alt=""/>
         </div>
        <div class="message">
           <p><b>avekshaa</b> Recived this high alert</p>
        </div>
      </div>
      <div class="update">
        <div class="profile-photo">
        <img src="./images/profile-3.jpg" alt=""/>
        </div>
       <div class="message">
          <p><b>avekshaa</b> Recived this high alert</p>
       </div>
     </div>
     <div class="update">
      <div class="profile-photo">
         <img src="./images/profile-2.jpg" alt=""/>
      </div>
     <div class="message">
        <p><b>avekshaa</b> Recived this high alert</p>
     </div>
   </div>
  </div>
  </div>


   <div class="sales-analytics">
     <h2> Analytics</h2>

      <div class="item onlion">
        <div class="icon">
          <span class="material-symbols-sharp"></span>
        </div>
        <div class="right_text">
          <div class="info">
            <h3>section empty</h3>
            <small class="text-muted">Last seen 2 Hours</small>
          </div>
         
        </div>
      </div>
      <div class="item onlion">
        <div class="icon">
          <span class="material-symbols-sharp"></span>
        </div>
        <div class="right_text">
          <div class="info">
           <h3>section empty</h3>
            <small class="text-muted">Last seen 2 Hours</small>
          </div>
          
        
        </div>
      </div>
      <div class="item onlion">
        <div class="icon">
          <span class="material-symbols-sharp"> </span>
        </div>
        <div class="right_text">
          <div class="info">
            <h3>section empty</h3>
            <small class="text-muted">Last seen 2 Hours</small>
          </div>
         
        
        </div>
      </div>
   
  

</div>

      <div class="item add_product">
            <div>
            <span class="material-symbols-sharp">add</span>
            </div>
     </div>
</div>
<script>
const updateContainer = document.querySelector('.updates');

// Function to make the API call
const makeApiCall = async () => {
    const token = localStorage.getItem('jwtToken');
    const response = await fetch('/alerts', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        }
    });

    if (!response.ok) {
        throw new Error('Network response was not ok ' + response.statusText);
    }

    const data = await response.json();
    updateUpdates(data);
};

// Function to update the updates section
const updateUpdates = (alerts) => {
    // Clear existing updates
    updateContainer.innerHTML = '';

    // Loop through the alerts and create update elements
    alerts.forEach(alert => {
        const updateDiv = document.createElement('div');
        updateDiv.className = 'update';

        updateDiv.innerHTML = `
            <div class="profile-photo">
                <img src="https://media.istockphoto.com/id/517998264/vector/male-user-icon.webp?s=1024x1024&w=is&k=20&c=i2eQlg8dK8RgTguGTyLmuCQ9IPBIlW-MXwDBMIPggVs=" alt=""/>
            </div>
            <div class="message">
                <p><b>${alert.username}</b> Received <span style="color:red"> ${alert.high} high</span>, <span style="color: #DAA520;">${alert.medium} medium</span>,<span style="color: green">${alert.low} low </span>alerts on ${alert.url}</p>
            </div>
        `;

        updateContainer.appendChild(updateDiv);
    });
};

// Schedule the API call every 5 minutes (300,000 milliseconds)
setInterval(makeApiCall, 300000);

// Initial call to start immediately
makeApiCall();

</script>
